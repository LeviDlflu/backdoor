<?xml version="1.0"?>
<Configuration>
  <SC-K21C>

    <Selects>

      <!--検索結果-->
      <SQL ID="SELECT_001">
        <Text>
          SELECT
            最新受払データ.大工程コード
            ,工程マスタ.工程略称
            ,品種マスタ.品種名
            ,COUNT(最新受払データ.大工程コード)　AS 数量
          FROM
            (SELECT
              RANK() OVER (PARTITION BY 事業所コード,個体NO ORDER BY シーケンス DESC) AS RANKNO
              ,事業所コード
              ,大工程コード
              ,品名事業所コード
              ,パック品名略称
              ,納入先コード
              ,納入区分
              ,製品半製品区分
              ,受払年月日
              ,受払区分
              ,払出区分
            FROM
              受払データ) AS 最新受払データ
          LEFT JOIN 工程マスタ
            ON 最新受払データ.大工程コード = 工程マスタ.大工程コード
          LEFT JOIN 生産製品マスタ
            ON 最新受払データ.品名事業所コード = 生産製品マスタ.品名事業所コード
            AND 最新受払データ.パック品名略称 = 生産製品マスタ.パック品名略称
            AND 最新受払データ.納入先コード = 生産製品マスタ.納入先コード
            AND 最新受払データ.納入区分 = 生産製品マスタ.納入区分
            AND 最新受払データ.製品半製品区分 = 生産製品マスタ.製品半製品区分
          LEFT JOIN 品種マスタ
            ON 生産製品マスタ.品種コード = 品種マスタ.品種コード
          WHERE
            最新受払データ.RANKNO = 1
            AND 最新受払データ.事業所コード = '{0}'
            AND 最新受払データ.受払区分 = '8'
            AND CONVERT(VARCHAR(7),最新受払データ.受払年月日,111) = '{1}'
            AND 最新受払データ.払出区分 = '{2}'
          GROUP BY
            最新受払データ.大工程コード
            ,工程マスタ.工程略称
            ,生産製品マスタ.品種コード
            ,品種マスタ.品種名
          ORDER BY
            最新受払データ.大工程コード
            ,品種マスタ.品種名
        </Text>
      </SQL>

    </Selects>
  </SC-K21C>
</Configuration>