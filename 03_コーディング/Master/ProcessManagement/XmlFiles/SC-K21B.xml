<?xml version="1.0"?>
<Configuration>
  <SC-K21B>

    <Selects>

      <!--検索結果-->
      <SQL ID="SELECT_001">
        <Text>
          SELECT
            最新受払データ.大工程コード
            ,工程マスタ.工程略称
            ,生産品名マスタ.品名略称
            ,COUNT(*)　AS 数量
          FROM
            (SELECT
              RANK() OVER (PARTITION BY 事業所コード,個体NO ORDER BY シーケンス DESC) AS RANKNO
              ,事業所コード
              ,大工程コード
              ,品名事業所コード
              ,パック品名略称
              ,納入先コード
              ,納入区分
              ,製品半製品区分
              ,受払年月日
              ,受払区分
              ,払出区分
            FROM
              受払データ) AS 最新受払データ
          LEFT JOIN 工程マスタ
            ON 最新受払データ.大工程コード = 工程マスタ.大工程コード
          LEFT JOIN 生産品名マスタ
            ON 最新受払データ.品名事業所コード = 生産品名マスタ.品名事業所コード
            AND 最新受払データ.パック品名略称 = 生産品名マスタ.パック品名略称
            AND 最新受払データ.納入先コード = 生産品名マスタ.納入先コード
            AND 最新受払データ.納入区分 = 生産品名マスタ.納入区分
            AND 最新受払データ.製品半製品区分 = 生産品名マスタ.製品半製品区分
          WHERE
            最新受払データ.RANKNO = 1
            AND 最新受払データ.事業所コード = '{0}'
            AND 最新受払データ.受払区分 = '8'
            AND CONVERT(VARCHAR(7),最新受払データ.受払年月日,111) = '{1}'
            AND 最新受払データ.払出区分 = '{2}'
          GROUP BY
            最新受払データ.大工程コード
            ,工程マスタ.工程略称
            ,最新受払データ.品名事業所コード
            ,最新受払データ.パック品名略称
            ,最新受払データ.納入先コード
            ,最新受払データ.納入区分
            ,最新受払データ.製品半製品区分
            ,生産品名マスタ.品名略称
          ORDER BY
            最新受払データ.大工程コード
            ,生産品名マスタ.品名略称
        </Text>
      </SQL>

    </Selects>
  </SC-K21B>
</Configuration>
